<div class="post-detail-container">
  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <p>Loading post...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
    <button (click)="loadPost()" class="btn-retry">Retry</button>
  </div>

  <!-- Post Content -->
  <div *ngIf="!loading && !error && post" class="post-content">
    <!-- Breadcrumb -->
    <div class="breadcrumb">
      <a routerLink="/forum">Forum</a> / 
      <a [routerLink]="['/forum/category', post.category_id]">{{ post.category_name }}</a> /
      <span>{{ post.title }}</span>
    </div>

    <!-- Post Header -->
    <div class="post-header">
      <div class="post-badges">
        <span *ngIf="post.is_pinned" class="badge badge-pinned">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">
            <path d="M12 17V22M12 2V7M12 7L7 2L5 4L12 7ZM12 7L17 2L19 4L12 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Pinned
        </span>
        <span *ngIf="post.is_locked" class="badge badge-locked">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">
            <rect x="5" y="11" width="14" height="10" rx="2" stroke="currentColor" stroke-width="2"/>
            <path d="M9 11V7C9 5.34315 10.3431 4 12 4C13.6569 4 15 5.34315 15 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Locked
        </span>
      </div>

      <div class="post-title-section">
        <h1 class="post-title">{{ post.title }}</h1>
        <div class="post-meta">
          <div class="author-info">
            <img 
              [src]="post.author.avatar_url || 'https://ui-avatars.com/api/?name=' + post.author.username + '&background=F0B90B&color=0B0E11'" 
              [alt]="post.author.username"
              class="author-avatar">
            <div>
              <span class="author-name">{{ post.author.username }}</span>
              <span *ngIf="post.author.reputation_level" 
                    class="badge" 
                    [ngClass]="'badge-' + post.author.reputation_level.toLowerCase()">
                {{ post.author.reputation_level }}
              </span>
            </div>
          </div>
          <div class="post-dates">
            <span>Created: {{ post.created_at | date:'medium' }}</span>
            <span *ngIf="post.updated_at">Modified: {{ post.updated_at | date:'medium' }}</span>
          </div>
        </div>
      </div>

      <div class="post-actions" *ngIf="canEditPost() || canDeletePost()">
        <button *ngIf="canEditPost()" [routerLink]="['/forum/post/edit', post.id]" class="btn-action">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
            <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Edit
        </button>
        <button *ngIf="canDeletePost()" (click)="deletePost()" class="btn-action btn-danger">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
            <path d="M3 6H5H21M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Delete
        </button>
      </div>
    </div>

    <!-- Post Body -->
    <div class="post-body">
      <div class="post-content-text" [innerHTML]="post.content"></div>
      
      <div class="post-tags" *ngIf="post.tags && post.tags.length > 0">
        <span *ngFor="let tag of post.tags" class="tag">{{ tag }}</span>
      </div>
    </div>

    <!-- Post Footer -->
    <div class="post-footer">
      <div class="vote-section">
        <button 
          (click)="votePost('UP')" 
          [class.active]="post.user_vote === 'UP'"
          class="vote-btn upvote">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="18" height="18">
            <path d="M7 13L12 8L17 13M7 6L12 1L17 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          {{ post.upvotes }}
        </button>
        <button 
          (click)="votePost('DOWN')" 
          [class.active]="post.user_vote === 'DOWN'"
          class="vote-btn downvote">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="18" height="18">
            <path d="M17 11L12 16L7 11M17 18L12 23L7 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          {{ post.downvotes }}
        </button>
      </div>
      
      <div class="post-stats">
        <span><strong>{{ post.view_count }}</strong> views</span>
        <span><strong>{{ post.comment_count }}</strong> comments</span>
      </div>
    </div>
  </div>

  <!-- Comments Section -->
  <div *ngIf="!loading && !error && post && !post.is_locked" class="comments-section">
    <h2>Comments ({{ post.comments.length }})</h2>

    <!-- Comment Form -->
    <form [formGroup]="commentForm" (ngSubmit)="submitComment()" class="comment-form">
      <textarea 
        formControlName="content" 
        placeholder="Write a comment..."
        rows="4"
        class="comment-input"></textarea>
      <div class="form-actions">
        <button 
          type="submit" 
          [disabled]="commentForm.invalid || isSubmittingComment"
          class="btn-submit">
          {{ isSubmittingComment ? 'Sending...' : 'Comment' }}
        </button>
      </div>
    </form>

    <!-- Comments List -->
    <div class="comments-list">
      <div *ngFor="let comment of post.comments" class="comment-item">
        <div class="comment-header">
          <img 
            [src]="comment.author.avatar_url || 'https://ui-avatars.com/api/?name=' + comment.author.username + '&background=F0B90B&color=0B0E11'" 
            [alt]="comment.author.username"
            class="comment-avatar">
          <div class="comment-author-info">
            <span class="comment-author">{{ comment.author.username }}</span>
            <span *ngIf="comment.author.reputation_level" 
                  class="badge" 
                  [ngClass]="'badge-' + comment.author.reputation_level.toLowerCase()">
              {{ comment.author.reputation_level }}
            </span>
            <span *ngIf="comment.is_solution" class="badge badge-solution">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">
                <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Solution
            </span>
            <span class="comment-date">{{ comment.created_at | date:'short' }}</span>
          </div>
          <div class="comment-actions">
            <button 
              (click)="voteComment(comment.id, 'UP')"
              [class.active]="comment.user_vote === 'UP'"
              class="vote-btn-small upvote">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">
                <path d="M7 13L12 8L17 13M7 6L12 1L17 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              {{ comment.upvotes }}
            </button>
            <button 
              (click)="voteComment(comment.id, 'DOWN')"
              [class.active]="comment.user_vote === 'DOWN'"
              class="vote-btn-small downvote">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">
                <path d="M17 11L12 16L7 11M17 18L12 23L7 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              {{ comment.downvotes }}
            </button>
            <button 
              *ngIf="canMarkSolution(comment)"
              (click)="markAsSolution(comment.id)"
              class="btn-mark-solution">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">
                <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Mark as Solution
            </button>
            <button 
              *ngIf="canEditComment(comment)"
              (click)="toggleReply(comment.id)"
              class="btn-reply">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">
                <path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Reply
            </button>
            <button 
              *ngIf="canEditComment(comment)"
              (click)="deleteComment(comment.id)"
              class="btn-delete">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">
                <path d="M3 6H5H21M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="comment-content">{{ comment.content }}</div>
        
        <!-- Replies -->
        <div *ngIf="comment.replies && comment.replies.length > 0" class="replies">
          <div *ngFor="let reply of comment.replies" class="reply-item">
            <div class="comment-header">
              <img 
                [src]="reply.author.avatar_url || 'https://ui-avatars.com/api/?name=' + reply.author.username + '&background=F0B90B&color=0B0E11'" 
                [alt]="reply.author.username"
                class="comment-avatar small">
              <div class="comment-author-info">
                <span class="comment-author">{{ reply.author.username }}</span>
                <span class="comment-date">{{ reply.created_at | date:'short' }}</span>
              </div>
              <div class="comment-actions">
                <button 
                  (click)="voteComment(reply.id, 'UP')"
                  class="vote-btn-small upvote">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">
                    <path d="M7 13L12 8L17 13M7 6L12 1L17 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  {{ reply.upvotes }}
                </button>
                <button 
                  (click)="voteComment(reply.id, 'DOWN')"
                  class="vote-btn-small downvote">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">
                    <path d="M17 11L12 16L7 11M17 18L12 23L7 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  {{ reply.downvotes }}
                </button>
              </div>
            </div>
            <div class="comment-content">{{ reply.content }}</div>
          </div>
        </div>

        <!-- Reply Form -->
        <div *ngIf="showReplyForm[comment.id]" class="reply-form">
          <form [formGroup]="replyForms[comment.id]" (ngSubmit)="submitReply(comment.id)">
            <textarea 
              formControlName="content" 
              placeholder="Write a reply..."
              rows="3"
              class="comment-input"></textarea>
            <div class="form-actions">
              <button type="button" (click)="toggleReply(comment.id)" class="btn-cancel">Cancel</button>
              <button 
                type="submit" 
                [disabled]="replyForms[comment.id]?.invalid || isSubmittingComment"
                class="btn-submit">
                Reply
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="post?.is_locked" class="locked-message">
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
      <rect x="5" y="11" width="14" height="10" rx="2" stroke="currentColor" stroke-width="2"/>
      <path d="M9 11V7C9 5.34315 10.3431 4 12 4C13.6569 4 15 5.34315 15 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <p>This post is locked. Comments are disabled.</p>
  </div>
</div>

