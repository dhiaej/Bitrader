<div class="wallet-container">
  <div class="page-header">
    <h1>My Wallet</h1>
    <div class="total-balance">
      <span class="label">Total Portfolio Value</span>
      <span class="amount">{{ getTotalBalance() | number:'1.2-2' }} USD</span>
    </div>
  </div>

  <div class="alert success" *ngIf="successMessage">{{ successMessage }}</div>
  <div class="alert error" *ngIf="errorMessage">{{ errorMessage }}</div>

  <!-- Wallets Grid -->
  <div class="wallets-section">
    <h2>Assets</h2>
    <div class="wallets-grid">
      <div class="wallet-card" *ngFor="let wallet of wallets">
        <div class="wallet-header">
          <div class="currency-info">
            <div class="currency-icon" [class]="wallet.currency.toLowerCase()">
              {{ wallet.currency === 'BTC' ? '₿' : wallet.currency === 'ETH' ? 'Ξ' : wallet.currency }}
            </div>
            <div>
              <h3>{{ wallet.currency }}</h3>
              <p class="currency-name">
                {{ wallet.currency === 'BTC' ? 'Bitcoin' :
                   wallet.currency === 'ETH' ? 'Ethereum' :
                   wallet.currency === 'USDT' ? 'Tether' : 'US Dollar' }}
              </p>
            </div>
          </div>
        </div>

        <div class="wallet-balance">
          <div class="balance-item">
            <span class="label">Available</span>
            <span class="value">{{ formatBalance(wallet.available_balance) }}</span>
          </div>
          <div class="balance-item locked">
            <span class="label">Locked</span>
            <span class="value">{{ formatBalance(wallet.locked_balance) }}</span>
          </div>
        </div>

        <div class="wallet-actions">
          <button class="btn-action deposit" (click)="openDepositModal(wallet)">
            <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
              <path d="M12 5V19M12 5L19 12M12 5L5 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Deposit
          </button>
          <button class="btn-action withdraw" (click)="openWithdrawModal(wallet)">
            <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
              <path d="M12 19V5M12 19L19 12M12 19L5 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Withdraw
          </button>
          <button class="btn-action transfer" (click)="openTransferModal(wallet)">
            <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
              <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Transfer
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Transaction History -->
  <div class="transactions-section">
    <h2>Transaction History</h2>
    <div class="transactions-table" *ngIf="transactions.length > 0">
      <table>
        <thead>
          <tr>
            <th>Type</th>
            <th>Currency</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Description</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let tx of transactions">
            <td>
              <span class="tx-type">
                <svg *ngIf="getTransactionIcon(tx.type) === 'deposit'" class="tx-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                  <path d="M12 5V19M12 5L19 12M12 5L5 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <svg *ngIf="getTransactionIcon(tx.type) === 'up'" class="tx-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                  <path d="M12 19V5M12 19L19 12M12 19L5 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <svg *ngIf="getTransactionIcon(tx.type) === 'right'" class="tx-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                  <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <svg *ngIf="getTransactionIcon(tx.type) === 'left'" class="tx-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                  <path d="M19 12H5M5 12L12 5M5 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <svg *ngIf="getTransactionIcon(tx.type) === 'cart'" class="tx-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                  <path d="M3 3H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19M9.68 16L11 10H19M9.68 16H7M19 10H11M17 20C17.5523 20 18 19.5523 18 19C18 18.4477 17.5523 18 17 18C16.4477 18 16 18.4477 16 19C16 19.5523 16.4477 20 17 20Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <svg *ngIf="getTransactionIcon(tx.type) === 'wallet'" class="tx-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                  <rect x="2" y="6" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                  <path d="M2 10H22" stroke="currentColor" stroke-width="2"/>
                  <circle cx="17" cy="14" r="2" fill="currentColor"/>
                </svg>
                <svg *ngIf="getTransactionIcon(tx.type) === 'lock'" class="tx-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                  <rect x="5" y="11" width="14" height="10" rx="2" stroke="currentColor" stroke-width="2"/>
                  <path d="M9 11V7C9 5.34315 10.3431 4 12 4C13.6569 4 15 5.34315 15 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <svg *ngIf="getTransactionIcon(tx.type) === 'unlock'" class="tx-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                  <rect x="5" y="11" width="14" height="10" rx="2" stroke="currentColor" stroke-width="2"/>
                  <path d="M9 11V7C9 5.34315 10.3431 4 12 4C13.6569 4 15 5.34315 15 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <svg *ngIf="getTransactionIcon(tx.type) === 'note'" class="tx-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                  <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                {{ tx.type }}
              </span>
            </td>
            <td><strong>{{ tx.currency }}</strong></td>
            <td>{{ formatBalance(tx.amount) }}</td>
            <td>
              <span [class]="'badge-' + tx.status.toLowerCase()">
                {{ tx.status }}
              </span>
            </td>
            <td class="description">{{ tx.description }}</td>
            <td class="date">{{ formatDate(tx.created_at) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="no-transactions" *ngIf="transactions.length === 0">
      No transactions yet. Start trading!
    </div>
  </div>
</div>

<!-- Deposit Modal -->
<div class="modal-overlay" *ngIf="showDepositModal" (click)="closeModals()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Deposit {{ selectedWallet?.currency }}</h2>
      <button class="btn-close" (click)="closeModals()">×</button>
    </div>
    <div class="modal-body">
      <form [formGroup]="depositForm" (ngSubmit)="onDeposit()">
        <div class="form-group">
          <label>Amount</label>
          <input
            type="number"
            formControlName="amount"
            placeholder="0.00"
            step="0.00000001"
          />
          <span class="help-text">Enter the amount to deposit (virtual)</span>
        </div>

        <div class="alert error" *ngIf="errorMessage">{{ errorMessage }}</div>

        <button type="submit" class="btn-submit" [disabled]="depositForm.invalid || isLoading">
          {{ isLoading ? 'Processing...' : 'Deposit' }}
        </button>
      </form>
    </div>
  </div>
</div>

<!-- Withdraw Modal -->
<div class="modal-overlay" *ngIf="showWithdrawModal" (click)="closeModals()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Withdraw {{ selectedWallet?.currency }}</h2>
      <button class="btn-close" (click)="closeModals()">×</button>
    </div>
    <div class="modal-body">
      <form [formGroup]="withdrawForm" (ngSubmit)="onWithdraw()">
        <div class="form-group">
          <label>Amount</label>
          <input
            type="number"
            formControlName="amount"
            placeholder="0.00"
            step="0.00000001"
          />
          <span class="help-text">Available: {{ formatBalance(selectedWallet?.available_balance || '0') }}</span>
        </div>

        <div class="form-group">
          <label>Withdrawal Address (Optional)</label>
          <input
            type="text"
            formControlName="address"
            placeholder="Enter destination address (optional for virtual game)"
          />
        </div>

        <div class="alert error" *ngIf="errorMessage">{{ errorMessage }}</div>

        <button type="submit" class="btn-submit" [disabled]="withdrawForm.invalid || isLoading">
          {{ isLoading ? 'Processing...' : 'Withdraw' }}
        </button>
      </form>
    </div>
  </div>
</div>

<!-- Transfer Modal -->
<div class="modal-overlay" *ngIf="showTransferModal" (click)="closeModals()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Transfer {{ selectedWallet?.currency }}</h2>
      <button class="btn-close" (click)="closeModals()">×</button>
    </div>
    <div class="modal-body">
      <form [formGroup]="transferForm" (ngSubmit)="onTransfer()">
        <div class="form-group">
          <label>Recipient Username</label>
          <input
            type="text"
            formControlName="recipient_username"
            placeholder="Enter username"
          />
        </div>

        <div class="form-group">
          <label>Amount</label>
          <input
            type="number"
            formControlName="amount"
            placeholder="0.00"
            step="0.00000001"
          />
          <span class="help-text">Available: {{ formatBalance(selectedWallet?.available_balance || '0') }}</span>
        </div>

        <div class="alert error" *ngIf="errorMessage">{{ errorMessage }}</div>

        <button type="submit" class="btn-submit" [disabled]="transferForm.invalid || isLoading">
          {{ isLoading ? 'Processing...' : 'Transfer' }}
        </button>
      </form>
    </div>
  </div>
</div>
