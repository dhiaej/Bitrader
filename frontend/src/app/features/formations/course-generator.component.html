<div class="course-generator-container">
  <div class="generator-header">
    <h1>G√©n√©rateur de Cours</h1>
    <p class="subtitle">G√©n√©rer un cours de trading bas√© sur les donn√©es de march√© r√©elles</p>
  </div>

  @if (!isAdmin()) {
    <div class="error-message">
      <p>‚ö†Ô∏è Acc√®s r√©serv√© aux administrateurs</p>
    </div>
  } @else {
    <div class="generator-content">
      <!-- Selection Form -->
      <div class="selection-card" [@fadeIn]>
        <h2>Param√®tres de G√©n√©ration</h2>
        
        <div class="form-group">
          <label for="symbol">Symbole de Trading</label>
          <select
            id="symbol"
            [(ngModel)]="selectedSymbol"
            [disabled]="isGenerating()"
            class="form-select"
          >
            <option value="">S√©lectionnez un symbole</option>
            @for (symbol of availableSymbols(); track symbol) {
              <option [value]="symbol">{{ symbol }}</option>
            }
          </select>
        </div>
        
        <div class="form-group">
          <label for="level">Niveau du Cours</label>
          <select
            id="level"
            [(ngModel)]="selectedLevel"
            [disabled]="isGenerating()"
            class="form-select"
          >
            <option value="BEGINNER">D√©butant</option>
            <option value="INTERMEDIATE">Interm√©diaire</option>
            <option value="ADVANCED">Avanc√©</option>
          </select>
        </div>
        
        <button
          (click)="generateCourse()"
          [disabled]="!selectedSymbol() || isGenerating()"
          class="btn-generate"
        >
          @if (isGenerating()) {
            <span class="spinner"></span>
            G√©n√©ration en cours...
          } @else {
            üöÄ G√©n√©rer le Cours
          }
        </button>
      </div>

      <!-- Error Message -->
      @if (error()) {
        <div class="error-message" [@fadeIn]>
          <p>‚ùå {{ error() }}</p>
        </div>
      }

      <!-- Generated Course Preview -->
      @if (generatedCourse(); as course) {
        <div class="course-preview" [@fadeIn]>
          <div class="preview-header">
            <h2>Aper√ßu du Cours G√©n√©r√©</h2>
            <p class="preview-note">V√©rifiez le contenu avant de sauvegarder</p>
          </div>
          
          <div class="course-info">
            <h3 class="course-title">{{ course.title }}</h3>
            <p class="course-description">{{ course.description }}</p>
            
            <div class="course-meta">
              <span class="meta-item">
                <strong>Niveau:</strong> {{ getLevelLabel(course.level) }}
              </span>
              <span class="meta-item">
                <strong>Dur√©e estim√©e:</strong> {{ course.estimated_duration }} min
              </span>
              <span class="meta-item">
                <strong>Nombre de le√ßons:</strong> {{ course.content_json?.length || 0 }}
              </span>
            </div>
          </div>
          
          <div class="lessons-preview">
            <h4>Le√ßons ({{ course.content_json?.length || 0 }})</h4>
            <div class="lessons-list">
              @for (lesson of course.content_json; track lesson.id) {
                <div class="lesson-preview-item">
                  <div class="lesson-header">
                    <span class="lesson-icon">{{ getLessonIcon(lesson.type) }}</span>
                    <span class="lesson-title">{{ lesson.title }}</span>
                    <span class="lesson-duration">{{ lesson.duration }} min</span>
                  </div>
                  <p class="lesson-preview">{{ lesson.data.substring(0, 150) }}...</p>
                </div>
              }
            </div>
          </div>
          
          @if (course.quiz?.questions) {
            <div class="quiz-preview">
              <h4>Quiz ({{ course.quiz.questions.length }} questions)</h4>
              <div class="questions-list">
                @for (question of course.quiz.questions; track $index) {
                  <div class="question-preview">
                    <p class="question-text">{{ question.question }}</p>
                    <ul class="options-list">
                      @for (option of question.options; track $index) {
                        <li [class.correct]="$index === question.correctAnswer">
                          {{ getOptionLetter($index) }}. {{ option }}
                        </li>
                      }
                    </ul>
                  </div>
                }
              </div>
            </div>
          }
          
          <div class="preview-actions">
            <button
              (click)="saveCourse()"
              [disabled]="isGenerating()"
              class="btn-save"
            >
              @if (isGenerating()) {
                <span class="spinner"></span>
                Sauvegarde...
              } @else {
                üíæ Sauvegarder le Cours
              }
            </button>
            <button
              (click)="generatedCourse.set(null)"
              [disabled]="isGenerating()"
              class="btn-cancel"
            >
              Annuler
            </button>
          </div>
        </div>
      }
    </div>
  }
</div>

