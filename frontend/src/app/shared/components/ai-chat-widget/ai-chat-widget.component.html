<div class="ai-chat-widget">
  <!-- Floating Chat Button -->
  <button class="chat-toggle-btn" (click)="toggleChat()" [class.open]="isOpen">
    <span class="icon">ğŸ’¬</span>
    <span class="tooltip">AI Trading Assistant</span>
  </button>

  <!-- Chat Window -->
  <div class="chat-window" [class.open]="isOpen">
    <!-- Header -->
    <div class="chat-header">
      <div class="header-content">
        <span class="ai-icon">ğŸ¤–</span>
        <div class="header-text">
          <h3>AI Trading Assistant</h3>
          <p>Powered by GPT-4o</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="icon-btn" (click)="clearChat()" title="Clear chat">
          <span>ğŸ—‘ï¸</span>
        </button>
        <button class="icon-btn close-btn" (click)="toggleChat()" title="Close">
          <span>âœ–ï¸</span>
        </button>
      </div>
    </div>

    <!-- Quick Suggestions -->
    <div class="quick-suggestions" *ngIf="messages.length === 0">
      <p class="suggestions-title">Quick Actions:</p>
      <div class="suggestion-buttons">
        <button
          *ngFor="let suggestion of quickSuggestions"
          class="suggestion-btn"
          (click)="useQuickSuggestion(suggestion.type)"
          [disabled]="isLoading">
          <span class="suggestion-icon">{{ suggestion.icon }}</span>
          {{ suggestion.label }}
        </button>
      </div>
    </div>

    <!-- Messages -->
    <div class="chat-messages" #chatMessages>
      <div
        *ngFor="let message of messages"
        class="message"
        [class.user-message]="message.role === 'user'"
        [class.assistant-message]="message.role === 'assistant'">
        <div class="message-content">
          <div class="message-bubble">
            {{ message.content }}
          </div>
          <span class="message-time">{{ formatTime(message.timestamp) }}</span>
        </div>
      </div>

      <!-- Loading Indicator -->
      <div *ngIf="isLoading" class="message assistant-message">
        <div class="message-content">
          <div class="message-bubble typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="messages.length === 0 && !isLoading" class="empty-state">
        <div class="empty-icon">ğŸ¤–</div>
        <h4>Welcome to AI Trading Assistant!</h4>
        <p>I can help you with:</p>
        <ul>
          <li>ğŸ“Š Market analysis and price trends</li>
          <li>ğŸ’¡ Trading strategies and tips</li>
          <li>âš ï¸ Risk assessment</li>
          <li>ğŸ’° Portfolio insights</li>
          <li>â“ Platform guidance</li>
        </ul>
      </div>
    </div>

    <!-- Input Area -->
    <div class="chat-input-area">
      <textarea
        [(ngModel)]="userInput"
        placeholder="Ask me anything about trading..."
        (keypress)="onKeyPress($event)"
        [disabled]="isLoading"
        rows="1"></textarea>
      <button
        class="send-btn"
        (click)="sendMessage()"
        [disabled]="!userInput.trim() || isLoading">
        <span *ngIf="!isLoading">ğŸ“¤</span>
        <span *ngIf="isLoading" class="spinner">â³</span>
      </button>
    </div>
  </div>
</div>
